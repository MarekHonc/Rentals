@model Rentals.Web.Models.ItemDetailViewModel
@using Rentals.Web.Localization

@{
	ViewBag.Title = Model.Name;
}
<section class="row" id="overview">
	<img class="col-sm-6 img-responsive" src="@Model.CoverImage" alt="@Model.Name" />
	<div class="col-sm-6">
		<h1>@Model.Name @if(Model.IsSpecificItem){<small>@Model.UniqueIdentifier</small>}</h1>
		<p>@Model.Description</p>
		@if (Model.Note != null)
		{
			<p>@Model.Note</p>
		}
		@if (!Model.IsSpecificItem)
		{
			<p>@Localization.ItemDetail_NumberOfItems: @Model.NumberOfItems</p>
			<form method="post" class="form-inline">
				<input type="hidden" value="@Model.Name" />
				<input id="count" type="number" class="form-control" min="1" max="@Model.NumberOfItems" value="1"/>
				<button type="submit" class="btn btn-success">@Localization.ItemDetail_AddToCart</button>
			</form>
		}
		else
		{
			<form method="post" class="form-inline">
				<input type="hidden" value="@Model.UniqueIdentifier" />
				<button type="submit" class="btn btn-success">@Localization.ItemDetail_AddToCart</button>
			</form>
		}
	</div>
</section>

<hr />

<section class="row" id="accessories">
	<h2 class="col-xs-12">@Localization.ItemDetail_Accessories</h2>
	@foreach (var accessory in Model.Accessories)
	{
		<div class="col-sm-4">
			<p>@Html.ActionLink(accessory.Name, "TypeDetail", "Home", new { itemType = accessory.Name.Replace(" ", string.Empty) }, new { @class = "non-underlined" })</p>
			<img src="@accessory.CoverImage" class="img-responsive" />
		</div>
	}
</section>

<hr />

<section class="row" id="avaibility">
	<h2 class="col-xs-12">
		@Localization.ItemDetail_TimeAvaibility @if (!Model.IsSpecificItem)
		{<small>@Localization.ItemDetail_TimeDependant</small>}
	</h2>
	<div id="calendar" class="col-xs-12"></div>
</section>

<script type="text/javascript">
	jq = jQuery.noConflict(false);

	jq(document).ready(function () {
		jq("#calendar").fullCalendar({
			defaultView: "agendaWeek",
			locale: "cs",
			slotDuration: "00:@Model.Rental.MinTimeUnit:00",
			allDaySlot: false,
			events: function (start, end, timezone, callback) {
				console.log(start);
				jq.ajax({
					url: '@Url.Action("GetTimeLine", "Home")',
					method: 'get',
					data: {
						item: "@Html.Raw(Model.IsSpecificItem ? Model.UniqueIdentifier : Model.Name)",
						count: jq("#count").val(),
						isSpecificItem: "@Model.IsSpecificItem",
						from: start.toJSON(),
						to: end.toJSON()
					},
					success: function (data) {

						console.log(data);
						var events = [{
							start: '2019-01-10T10:00:00',
							end: '2019-01-10T16:00:00',
							rendering: 'background'
						}];


						callback(data);
					},
					error: function () {
						alert("Hups");
					}
				});
			}
		});
	});
</script>